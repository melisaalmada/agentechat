<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Chat para Agentes de Soporte</title>
    <style>
        :root {
            --primary-color: #4267B2;
            --secondary-color: #898F9C;
            --light-color: #F0F2F5;
            --dark-color: #1C1E21;
            --agent-color: #0084FF;
            --client-color: #E4E6EB;
            --success-color: #42B983;
            --warning-color: #FFC107;
            --danger-color: #DC3545;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .timer-section {
            background: var(--dark-color);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .timer {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .timer.warning {
            color: var(--warning-color);
        }
        
        .timer.danger {
            color: var(--danger-color);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .score {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .chat-container {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: var(--light-color);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            animation: fadeIn 0.3s ease;
            position: relative;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .client-message {
            background-color: var(--client-color);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .agent-message {
            background-color: var(--agent-color);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }
        
        .input-container {
            padding: 15px 20px;
            background: white;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
        }
        
        input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 1rem;
        }
        
        button {
            padding: 12px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #365899;
        }
        
        .structure-section {
            background: white;
            padding: 20px;
            border-top: 1px solid #ddd;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .structure-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .structure-list {
            list-style-type: decimal;
            padding-left: 20px;
        }
        
        .structure-list li {
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .results {
            padding: 20px;
            background: var(--light-color);
            display: none;
        }
        
        .results h2 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .results-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .results-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .results-section h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        .missing-steps {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .completed-steps {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .final-score {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 20px 0;
            color: var(--primary-color);
        }
        
        .restart-btn {
            display: block;
            margin: 0 auto;
            padding: 12px 25px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .restart-btn:hover {
            background: #365899;
        }
        
        @media (max-width: 768px) {
            .results-content {
                grid-template-columns: 1fr;
            }
            
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Simulador de Chat para Agentes de Soporte</h1>
            <p class="subtitle">Atiende al cliente siguiendo la estructura correcta</p>
        </header>
        
        <div class="timer-section">
            <div class="timer" id="timer">30:00</div>
            <div class="score" id="score">Puntuación: 0%</div>
        </div>
        
        <div class="chat-container" id="chatContainer">
            <div class="message client-message">
                ¡Hola, buenos días! Gracias por responder. 😞<br>
                Junto con mi hermana tengo una página de juguetes y necesito responder los mensajes de los anuncios que realizo, pero no me permite. ¿Por favor me ayudas?
                <div class="message-time" id="initialTime">10:00 AM</div>
            </div>
        </div>
        
        <div class="input-container">
            <input type="text" id="userInput" placeholder="Escribe tu respuesta como agente...">
            <button id="sendButton">Enviar</button>
        </div>
        
        <div class="structure-section">
            <div class="structure-title">Estructura que debe seguir el agente:</div>
            <ol class="structure-list">
                <li><strong>SALUDO</strong>: Presentación y número de caso</li>
                <li><strong>RECAPITULACIÓN INICIAL</strong>: Confirmar el problema</li>
                <li><strong>EMPATÍA</strong>: Mostrar comprensión</li>
                <li><strong>AGRADECER Y PEDIR TIEMPO</strong>: Solicitar minutos para investigar</li>
                <li><strong>LLAMADA</strong>: Ofrecer llamada y confirmar número</li>
                <li><strong>PREGUNTAR SI HIZO EL PASO A PASO</strong>: Verificar acciones del cliente</li>
                <li><strong>RECAPITULACIÓN FINAL Y AYUDA ADICIONAL</strong>: Resumen y ofrecer más ayuda</li>
                <li><strong>INFORMAR CIERRE</strong>: Anunciar el cierre del caso</li>
                <li><strong>DESPEDIDA</strong>: Mensaje final y enlace de ayuda</li>
            </ol>
        </div>
        
        <div class="results" id="results">
            <h2>Resultados de la Interacción</h2>
            <div class="final-score" id="finalScore">Puntuación: 0%</div>
            
            <div class="results-content">
                <div class="results-section">
                    <h3>Pasos Completados</h3>
                    <div id="completedSteps"></div>
                </div>
                
                <div class="results-section">
                    <h3>Pasos Omitidos</h3>
                    <div id="missingSteps"></div>
                </div>
            </div>
            
            <button class="restart-btn" id="restartButton">Reiniciar Simulación</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chatContainer');
            const userInput = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');
            const timerElement = document.getElementById('timer');
            const scoreElement = document.getElementById('score');
            const resultsElement = document.getElementById('results');
            const finalScoreElement = document.getElementById('finalScore');
            const completedStepsElement = document.getElementById('completedSteps');
            const missingStepsElement = document.getElementById('missingSteps');
            const restartButton = document.getElementById('restartButton');
            
            let timerInterval;
            let timeLeft = 30 * 60; // 30 minutos en segundos
            let score = 0;
            let chatStarted = false;
            let caseNumber = generateCaseNumber();
            
            // Estructura de pasos requeridos
            const requiredSteps = [
                { 
                    id: 'saludo',
                    name: 'SALUDO', 
                    description: 'Presentación y número de caso',
                    completed: false,
                    keywords: ['hola', 'buenos días', 'buenas tardes', 'nombre es', 'caso número', 'meta support pro', 'meta pro team']
                },
                { 
                    id: 'recapitulacion',
                    name: 'RECAPITULACIÓN INICIAL', 
                    description: 'Confirmar el problema',
                    completed: false,
                    keywords: ['de acuerdo', 'nos comentas', 'necesitas ayuda', 'responder mensajes', 'anuncios', 'es correcto', '¿correcto?']
                },
                { 
                    id: 'empatia',
                    name: 'EMPATÍA', 
                    description: 'Mostrar comprensión',
                    completed: false,
                    keywords: ['entiendo', 'comprendo', 'situación', 'importante', 'no te preocupes', 'ayudarte']
                },
                { 
                    id: 'tiempo',
                    name: 'AGRADECER Y PEDIR TIEMPO', 
                    description: 'Solicitar minutos para investigar',
                    completed: false,
                    keywords: ['gracias', 'espera', 'información', 'minutos', 'recopilar', 'retorno', '¿vale?']
                },
                { 
                    id: 'llamada',
                    name: 'LLAMADA', 
                    description: 'Ofrecer llamada y confirmar número',
                    completed: false,
                    keywords: ['llamada', 'número', 'telefónico', 'disponible', 'confirmas', 'número telefónico']
                },
                { 
                    id: 'paso_a_paso',
                    name: 'PREGUNTAR SI HIZO EL PASO A PASO', 
                    description: 'Verificar acciones del cliente',
                    completed: false,
                    keywords: ['pudiste', 'realizar', 'paso a paso', 'indicas', 'probar', 'intentar']
                },
                { 
                    id: 'recapitulacion_final',
                    name: 'RECAPITULACIÓN FINAL Y AYUDA ADICIONAL', 
                    description: 'Resumen y ofrecer más ayuda',
                    completed: false,
                    keywords: ['placer', 'brindarte', 'apoyo', 'información', 'más ayuda', 'algo más']
                },
                { 
                    id: 'cierre',
                    name: 'INFORMAR CIERRE', 
                    description: 'Anunciar el cierre del caso',
                    completed: false,
                    keywords: ['finalizar', 'cerrar', 'caso', 'procedo', 'terminamos']
                },
                { 
                    id: 'despedida',
                    name: 'DESPEDIDA', 
                    description: 'Mensaje final y enlace de ayuda',
                    completed: false,
                    keywords: ['canales', 'atención', 'facebook', 'business', 'help', 'excelente día', 'meta pro team']
                }
            ];
            
            // Generar número de caso aleatorio
            function generateCaseNumber() {
                return Math.floor(1000000000 + Math.random() * 9000000000).toString();
            }
            
            // Actualizar el temporizador
            function updateTimer() {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Cambiar color según el tiempo restante
                if (timeLeft <= 5 * 60) {
                    timerElement.classList.add('danger');
                    timerElement.classList.remove('warning');
                } else if (timeLeft <= 10 * 60) {
                    timerElement.classList.add('warning');
                    timerElement.classList.remove('danger');
                } else {
                    timerElement.classList.remove('warning', 'danger');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endChat(false);
                } else {
                    timeLeft--;
                }
            }
            
            // Obtener la hora actual formateada
            function getCurrentTime() {
                const now = new Date();
                return now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();
            }
            
            // Agregar mensaje al chat
            function addMessage(message, isAgent) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(isAgent ? 'agent-message' : 'client-message');
                
                const timeDiv = document.createElement('div');
                timeDiv.classList.add('message-time');
                timeDiv.textContent = getCurrentTime();
                
                messageDiv.textContent = message;
                messageDiv.appendChild(timeDiv);
                
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // Verificar si se completaron los pasos requeridos
            function checkRequiredSteps(message) {
                const lowerMessage = message.toLowerCase();
                
                requiredSteps.forEach(step => {
                    if (!step.completed) {
                        // Verificar si el mensaje contiene palabras clave del paso
                        if (step.keywords.some(keyword => lowerMessage.includes(keyword))) {
                            step.completed = true;
                            score += 10; // 10% por cada paso completado
                            scoreElement.textContent = `Puntuación: ${score}%`;
                        }
                    }
                });
                
                // Verificar si el agente finalizó el chat correctamente
                if (lowerMessage.includes('end chat') || lowerMessage.includes('done > answered')) {
                    endChat(true);
                }
            }
            
            // Finalizar el chat y mostrar resultados
            function endChat(agentInitiated) {
                clearInterval(timerInterval);
                
                // Deshabilitar entrada de mensajes
                userInput.disabled = true;
                sendButton.disabled = true;
                
                // Mostrar mensaje final
                if (agentInitiated) {
                    addMessage("¡Gracias por tu ayuda! Que tengas un excelente día. 😊", false);
                } else {
                    addMessage("El tiempo se ha agotado. La conversación ha finalizado.", false);
                }
                
                // Calcular puntuación final
                if (timeLeft > 0 && agentInitiated) {
                    // Bono por tiempo restante (1% por cada minuto restante)
                    const timeBonus = Math.floor(timeLeft / 60);
                    score = Math.min(100, score + timeBonus);
                }
                
                // Mostrar resultados
                finalScoreElement.textContent = `Puntuación: ${score}%`;
                
                let completedHTML = '';
                let missingHTML = '';
                
                requiredSteps.forEach(step => {
                    if (step.completed) {
                        completedHTML += `<p class="completed-steps">${step.name}: ${step.description}</p>`;
                    } else {
                        missingHTML += `<p class="missing-steps">${step.name}: ${step.description}</p>`;
                    }
                });
                
                completedStepsElement.innerHTML = completedHTML || '<p>No completaste ningún paso requerido.</p>';
                missingStepsElement.innerHTML = missingHTML || '<p>¡Felicidades! Completaste todos los pasos.</p>';
                
                resultsElement.style.display = 'block';
            }
            
            // Manejar el envío de mensajes
            function sendMessage() {
                const message = userInput.value.trim();
                
                if (message) {
                    // Iniciar el chat y temporizador si es el primer mensaje
                    if (!chatStarted) {
                        if (message.toLowerCase().includes('start')) {
                            chatStarted = true;
                            timerInterval = setInterval(updateTimer, 1000);
                            addMessage(message, true);
                            userInput.value = '';
                        } else {
                            alert('Debes comenzar la conversación con "START"');
                            return;
                        }
                    } else {
                        addMessage(message, true);
                        userInput.value = '';
                        checkRequiredSteps(message);
                    }
                    
                    // Simular respuesta del cliente después de un breve retraso
                    if (chatStarted) {
                        setTimeout(() => {
                            if (message.toLowerCase().includes('llamada') || message.toLowerCase().includes('número')) {
                                addMessage("Sí, estoy disponible. Mi número es 123-456-7890.", false);
                            } else if (message.toLowerCase().includes('paso a paso') || message.toLowerCase().includes('pudiste')) {
                                addMessage("Sí, intenté seguir los pasos pero aún no me funciona.", false);
                            } else if (message.toLowerCase().includes('algo más') || message.toLowerCase().includes('más ayuda')) {
                                addMessage("No, eso sería todo por ahora. Muchas gracias.", false);
                            } else {
                                addMessage("Entiendo, gracias por la información. ¿Qué debo hacer ahora?", false);
                            }
                        }, 1000);
                    }
                }
            }
            
            // Reiniciar la simulación
            function restartSimulation() {
                // Limpiar chat
                chatContainer.innerHTML = `
                    <div class="message client-message">
                        ¡Hola, buenos días! Gracias por responder. 😞<br>
                        Junto con mi hermana tengo una página de juguetes y necesito responder los mensajes de los anuncios que realizo, pero no me permite. ¿Por favor me ayudas?
                        <div class="message-time">${getCurrentTime()}</div>
                    </div>
                `;
                
                // Reiniciar variables
                timeLeft = 30 * 60;
                score = 0;
                chatStarted = false;
                caseNumber = generateCaseNumber();
                
                // Reiniciar UI
                timerElement.textContent = '30:00';
                timerElement.classList.remove('warning', 'danger');
                scoreElement.textContent = 'Puntuación: 0%';
                userInput.disabled = false;
                sendButton.disabled = false;
                resultsElement.style.display = 'none';
                
                // Reiniciar pasos
                requiredSteps.forEach(step => {
                    step.completed = false;
                });
                
                // Detener temporizador si estaba corriendo
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
            }
            
            // Event listeners
            sendButton.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            restartButton.addEventListener('click', restartSimulation);
            
            // Mensaje inicial con el número de caso
            userInput.placeholder = `Escribe START para comenzar (Caso ${caseNumber})`;
        });
    </script>
</body>
</html>